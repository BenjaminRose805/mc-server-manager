{
  "id": "snapshot_1770856573159_jupyfq41r",
  "approvalId": "approval_1770856573143_87dg5in8c",
  "approvalTitle": "EPIC-7: Shared Minecraft Servers â€” Requirements Document",
  "version": 1,
  "timestamp": "2026-02-12T00:36:13.159Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document -- Shared Minecraft Servers\n\n## Introduction\n\nEnable server owners to share their Minecraft servers with community members, transforming MC Server Manager from a personal tool into a community platform. Members can browse shared servers, see who is playing, join with one click (or copy-paste), and -- if permitted -- manage servers remotely. This epic bridges the social platform (Epic 6) with the core server management functionality.\n\nServer sharing is built on a per-server, four-level permission model (view, join, manage, admin) that is granular enough for flexibility yet simple enough to understand. Whitelists are automatically managed based on community membership and join permissions, eliminating manual whitelist editing. The existing console feature (Epic 1) becomes available to remote users gated by the admin permission level.\n\nDependencies: Epic 5 (Multi-User Foundation) for user accounts and authentication.\nOptional dependencies: Epic 3 (Client Launcher) for one-click join that auto-launches Minecraft. Without Epic 3, users receive the server address for manual copy-paste. Epic 2 (Server Mods) for mod detection in the server browser.\nPrerequisite for: Epic 9 (Mod Sync -- shared servers provide the mod list for auto-sync on join).\n\n## Alignment with Product Vision\n\nAfter Epic 5 (Multi-User Foundation) adds authentication and Epic 6 (Friends and Text Chat) adds social features, Epic 7 closes the loop by making the core value proposition -- Minecraft server management -- a shared experience. Community members gain visibility into available servers, can join with minimal friction, and trusted users can remotely manage servers. This makes the platform a natural gathering place for gaming groups rather than just a solo admin dashboard.\n\n---\n\n## Requirements\n\n### REQ-1: Server Sharing and Visibility Settings\n\n**User Story:** As a server owner or admin, I want to share my Minecraft server with the community, so that members can discover and join it through the server browser.\n\n#### Acceptance Criteria\n\n1. WHEN a server admin enables sharing on a server THEN the system SHALL add a \"shared\" flag to the server record and make it visible in the community server browser.\n2. WHEN sharing is enabled THEN the system SHALL allow the admin to set a display name (different from the internal server name) and an optional description (at most 500 characters).\n3. WHEN sharing is disabled THEN the system SHALL remove the server from the community browser immediately and stop broadcasting status updates to community members.\n4. WHEN sharing is enabled THEN the system SHALL record the timestamp of when sharing was activated.\n5. WHEN a server admin enables sharing with no user permissions configured THEN no community members SHALL be able to join (view-only by default requires explicit permission grants).\n\n---\n\n### REQ-2: Server Permission Model\n\n**User Story:** As a server admin, I want to grant granular permissions to community members for each server, so that I can control who can view, join, manage, and administer my servers.\n\n#### Acceptance Criteria\n\n1. WHEN a permission is granted to a user for a server THEN the system SHALL store it with one of four levels: view, join, manage, or admin.\n2. WHEN a user has a permission level THEN the system SHALL treat it as including all lower levels (admin includes manage, join, and view; manage includes join and view; join includes view).\n3. WHEN an admin grants a permission THEN the system SHALL record who granted it and when.\n4. WHEN an admin revokes a permission THEN the system SHALL remove the permission record entirely and trigger any associated side effects (whitelist removal for join-level revocations).\n5. WHEN a user has no permission for a shared server THEN they SHALL still see it in the browser (shared servers are visible to all authenticated community members) but cannot join, manage, or administer it.\n6. WHEN a user has \"view\" permission THEN they SHALL see the server in the browser with its status and player list.\n7. WHEN a user has \"join\" permission THEN they SHALL be able to request connection info and be automatically added to the server whitelist.\n8. WHEN a user has \"manage\" permission THEN they SHALL be able to start, stop, restart the server, edit server.properties, and view the console.\n9. WHEN a user has \"admin\" permission THEN they SHALL have full control including deleting the server, changing sharing settings, and granting or revoking permissions for other users.\n\n---\n\n### REQ-3: Server Browser\n\n**User Story:** As an authenticated community member, I want to browse all shared servers with live status information, so that I can find a server to join.\n\n#### Acceptance Criteria\n\n1. WHEN a user navigates to the server browser THEN the system SHALL display all servers that have sharing enabled, regardless of the user's individual permission level.\n2. WHEN the server browser loads THEN each server card SHALL display: display name, server type and version, current status (running, stopped, starting, stopping, crashed), player count out of max players, and the list of online player names.\n3. WHEN a server's status changes (start, stop, crash) THEN the server browser SHALL update in real time via WebSocket without requiring a page refresh.\n4. WHEN a server's player count changes (player join or leave) THEN the browser SHALL reflect the update in real time.\n5. WHEN a user views a server card THEN it SHALL indicate the user's current permission level for that server (view only, can join, can manage, or admin).\n\n---\n\n### REQ-4: One-Click Join\n\n**User Story:** As a community member with join permission, I want to join a shared Minecraft server with one click, so that I can start playing with minimal friction.\n\n#### Acceptance Criteria\n\n1. WHEN a user with \"join\" permission clicks the Join button on a running server THEN the system SHALL return connection info (address and port) and the server version.\n2. WHEN the application is running as a Tauri desktop app with Epic 3 (Client Launcher) available THEN the system SHALL launch the Minecraft client automatically configured for the correct server address and version.\n3. WHEN Epic 3 is NOT available THEN the system SHALL copy the server address to the clipboard and show a toast notification confirming the copy.\n4. WHEN a user without \"join\" permission attempts to join THEN the system SHALL deny the request with a 403 Forbidden error.\n5. WHEN a user clicks Join on a server that is not running THEN the Join button SHALL be disabled with a visual indicator that the server is offline.\n\n---\n\n### REQ-5: Whitelist Auto-Sync\n\n**User Story:** As a server admin, I want the server whitelist to be automatically managed based on permissions, so that I never have to manually edit whitelist.json.\n\n#### Acceptance Criteria\n\n1. WHEN a user is granted \"join\" permission (or higher) for a server THEN the system SHALL add the user's Minecraft username and UUID to the server's whitelist.json file.\n2. WHEN a user's permission is revoked (dropping below \"join\" level) THEN the system SHALL remove the user's entry from whitelist.json.\n3. WHEN the server is running during a whitelist change THEN the system SHALL send the appropriate \"whitelist add\" or \"whitelist remove\" command via stdin AND send \"whitelist reload\" to apply changes immediately.\n4. WHEN the server is stopped during a whitelist change THEN the system SHALL edit whitelist.json directly (changes take effect on next startup).\n5. WHEN sharing is enabled on a server THEN the system SHALL perform a full whitelist sync, adding all users who currently have \"join\" permission or higher.\n6. WHEN the user does not have a linked Minecraft account (Epic 3 not implemented or account not linked) THEN whitelist sync SHALL be a no-op and the system SHALL log a warning.\n\n---\n\n### REQ-6: Shared Console Access\n\n**User Story:** As a user with admin permission on a shared server, I want to view the server console and send commands, so that I can remotely troubleshoot and manage the server.\n\n#### Acceptance Criteria\n\n1. WHEN a user with \"admin\" permission subscribes to a shared server's console via WebSocket THEN the system SHALL stream console output to them in real time (same as the existing console feature).\n2. WHEN a user with \"admin\" permission sends a command to a shared server THEN the system SHALL execute it via stdin (same as existing command functionality).\n3. WHEN a user with \"manage\" permission attempts to access the console THEN the system SHALL deny the subscription with a permission error.\n4. WHEN a user with \"admin\" permission views a shared server THEN they SHALL see a console tab or section with the same functionality as the owner's console view.\n\n---\n\n### REQ-7: Player Tracking and Status\n\n**User Story:** As a community member, I want to see who is currently playing on a shared server, so that I can decide whether to join.\n\n#### Acceptance Criteria\n\n1. WHEN a player joins or leaves a running shared server THEN the system SHALL broadcast the updated player list to all connected community members who have at least \"view\" permission via WebSocket.\n2. WHEN the server browser displays a server card THEN it SHALL show the current number of online players and the maximum player count.\n3. WHEN online players exist THEN the server card SHALL display their Minecraft usernames.\n4. WHEN no players are online THEN the server card SHALL show \"0\" for the player count with no player name list.\n\n---\n\n### REQ-8: Permission-Gated Server Controls\n\n**User Story:** As a user with manage permission, I want to start, stop, and restart a shared server, so that I can help administer it without needing full admin access.\n\n#### Acceptance Criteria\n\n1. WHEN a user with \"manage\" permission views a shared server THEN the system SHALL display start, stop, and restart control buttons.\n2. WHEN a user with \"manage\" permission clicks a server control button THEN the system SHALL execute the corresponding action (start, stop, restart) on the server.\n3. WHEN a user with only \"join\" or \"view\" permission views a shared server THEN the control buttons SHALL NOT be displayed.\n4. WHEN a user with \"manage\" permission views a shared server THEN they SHALL also have access to view and edit server.properties.\n\n---\n\n## Non-Functional Requirements\n\n### Performance\n- The shared server list endpoint SHALL respond within 200ms for communities with up to 50 shared servers.\n- WebSocket status broadcasts SHALL be sent only to users who have at least \"view\" permission for the server, to minimize unnecessary traffic.\n- The server browser SHALL use a responsive grid layout that renders efficiently with up to 50 server cards.\n\n### Security\n- All community server API endpoints SHALL require JWT authentication (from Epic 5).\n- Permission checks SHALL be enforced at the API layer via middleware, not solely in the frontend UI.\n- The permission middleware SHALL verify the user's permission level on every request, not cache permissions client-side for authorization decisions.\n- Console access SHALL be gated behind the \"admin\" permission level to prevent exposure of sensitive server logs (e.g., player IP addresses).\n- Whitelist.json writes SHALL validate JSON structure before writing to prevent file corruption.\n\n### User Experience\n- The server browser SHALL use a card-based grid layout (responsive: 1 column on mobile, 2 on medium, 3 on large screens).\n- Server status SHALL be indicated by a colored dot: green for running, yellow for starting, orange for stopping, gray for stopped, red for crashed.\n- The Join button SHALL be clearly disabled with a visual explanation when the server is offline or the user lacks permission.\n- Permission levels SHALL be displayed as color-coded badges (view=gray, join=blue, manage=purple, admin=red).\n- Sharing settings SHALL include a confirmation prompt when first enabling sharing to prevent accidental exposure.\n\n### Reliability\n- Whitelist sync failures SHALL be logged but SHALL NOT block permission changes (fire-and-forget with error logging).\n- If a user's Minecraft account is not linked, the system SHALL gracefully degrade (sharing works, but whitelist sync is skipped with a logged warning).\n- WebSocket disconnection and reconnection SHALL re-establish the user's subscriptions to shared server updates.\n",
  "fileStats": {
    "size": 12350,
    "lines": 160,
    "lastModified": "2026-02-12T00:30:05.931Z"
  },
  "comments": []
}