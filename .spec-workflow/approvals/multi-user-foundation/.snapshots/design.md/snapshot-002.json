{
  "id": "snapshot_1770854960986_stw0cbyki",
  "approvalId": "approval_1770854878817_1e2cvobcj",
  "approvalTitle": "EPIC-5: Multi-User Foundation â€” Design Document",
  "version": 2,
  "timestamp": "2026-02-12T00:09:20.986Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document -- Multi-User Foundation\n\n## Overview\n\nTransform MC Server Manager from a single-user desktop application into a multi-user community platform. The host runs the Express backend as a network-facing server that friends connect to over the internet. This design covers the authentication system (JWT + refresh tokens), invitation-based registration, role-based access control with granular per-server permissions, TLS/HTTPS support, security hardening, and the frontend auth UI.\n\nThis is the platform pivot -- all subsequent social features (Friends & Chat, Shared Servers, Voice, Mod Sync) depend on this multi-user foundation.\n\n## Steering Document Alignment\n\nNo steering docs exist. This design follows existing project conventions (Express routes, Zod validation, SQLite models, Zustand store, Tailwind UI) and the patterns established in the AGENTS.md.\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n- **`packages/backend/src/utils/errors.ts`**: Custom error classes (AppError, NotFoundError, ConflictError). Extended with `UnauthorizedError` and `ForbiddenError` for auth.\n- **`packages/backend/src/models/settings.ts`** (or equivalent settings table): Key-value store used for JWT secret, TLS config, and network settings.\n- **`packages/backend/src/config.ts`**: Application configuration. Extended with host binding, TLS mode, and multi-user settings.\n- **`packages/frontend/src/api/client.ts`**: Existing API client. Modified to inject `Authorization` headers on all requests.\n- **`packages/frontend/src/api/ws.ts`**: WebSocket client. Modified to pass access token during connection handshake.\n- **Express route patterns**: Existing routes in `packages/backend/src/routes/` serve as the template for auth, user, invitation, and permission routes.\n- **Zod validation patterns**: All existing routes use Zod schemas for request validation. Auth routes follow the same pattern.\n- **Pino logger**: Existing logger instance reused for auth event logging (with sensitive data redaction).\n\n### Integration Points\n- **`servers` table**: Foreign key target for `server_permissions` table. Server routes gain permission middleware.\n- **WebSocket handlers**: Existing `subscribe`/`command` handlers gain auth token verification and permission checks.\n- **Express middleware chain**: Auth middleware, rate limiting, CORS, and Helmet inserted before existing route handlers.\n- **Settings table**: Extended with JWT secret, TLS configuration, and network settings.\n\n## Architecture\n\n### Authentication Flow\n\n```\nFirst Run (Setup):\n  App detects 0 users --> Show setup wizard --> POST /api/auth/setup\n  --> Create owner account (argon2id hash) --> Return JWT + refresh token\n\nFriend Registration (Invite-Based):\n  Owner creates invite (POST /api/invitations) --> Shares code/link\n  --> Friend registers (POST /api/auth/register) with invite code\n  --> Validate invite (not expired, uses remaining) --> Create account\n  --> Return JWT + refresh token\n\nLogin:\n  POST /api/auth/login --> Check brute force lockout\n  --> Verify password (argon2.verify) --> Generate access token (15min JWT)\n  --> Generate refresh token (30-day, hashed in DB) --> Return both\n\nToken Refresh:\n  Access token expires --> Frontend detects 401 --> POST /api/auth/refresh\n  --> Hash refresh token, lookup in sessions --> Verify not expired\n  --> Generate new access token --> Optionally rotate refresh token\n\nLogout:\n  POST /api/auth/logout --> Delete session record --> Frontend discards tokens\n```\n\n### Permission Resolution\n\n```\n                        Request arrives\n                             |\n                     requireAuth middleware\n                     (verify JWT, attach user)\n                             |\n                    +--------+--------+\n                    |                 |\n               Owner/Admin?       Member?\n               (bypass all)    (check server_permissions)\n                    |                 |\n                 ALLOW        has record with flag=1?\n                                     |\n                              +------+------+\n                              |             |\n                            ALLOW        DENY (403)\n```\n\n### Architecture Shift\n\n```\nBefore (Single-User):\n  Tauri App (localhost only)\n    --> Express Backend (127.0.0.1:3001, no auth)\n\nAfter (Multi-User):\n  Host's Tauri App                     Friend's Tauri App\n    --> Express Backend                   --> (connects remotely)\n        (0.0.0.0:3001, HTTPS)                   |\n              ^                                  |\n              +----------------------------------+\n                      (over internet, TLS)\n```\n\n### Modular Design Principles\n- **Single Responsibility**: Each auth concern in its own service file -- `auth.ts` (password hashing), `jwt.ts` (token generation/verification), `session.ts` (refresh token management), `brute-force.ts` (login attempt tracking).\n- **Composable Middleware**: `requireAuth`, `requireRole('admin')`, `requireServerPermission('can_start')` -- each is a standalone middleware that can be combined in route definitions.\n- **Backward Compatibility**: When no users exist in the database, all existing functionality works without authentication. Auth middleware skips verification in single-user mode.\n- **Route Separation**: Auth routes (`auth.ts`), user routes (`users.ts`), invitation routes (`invitations.ts`), and permission routes (extension to `servers.ts`) are each in separate files.\n\n## Components and Interfaces\n\n### Component 1: Password Hashing Service (`packages/backend/src/services/auth.ts`)\n- **Purpose**: Hash and verify passwords using argon2id\n- **Interfaces**: `hashPassword(password: string): Promise<string>`, `verifyPassword(hash: string, password: string): Promise<boolean>`\n- **Dependencies**: `argon2` npm package\n- **Reuses**: None (new foundational service)\n\n### Component 2: JWT Service (`packages/backend/src/services/jwt.ts`)\n- **Purpose**: Generate and verify JWT access tokens (HS256, 15-min expiry)\n- **Interfaces**: `generateAccessToken(user: User): string`, `verifyAccessToken(token: string): JWTPayload | null`, `getOrCreateJWTSecret(): string`\n- **Dependencies**: `jsonwebtoken` npm package, settings model (for secret storage)\n- **Reuses**: Settings table for persistent secret storage\n\n### Component 3: Session Service (`packages/backend/src/services/session.ts`)\n- **Purpose**: Manage refresh tokens (30-day expiry) -- create, validate, revoke, cleanup\n- **Interfaces**: `generateRefreshToken(): string`, `hashRefreshToken(token: string): string`, `createSession(userId, refreshToken, deviceInfo, ipAddress): Session`, `validateRefreshToken(token: string): Session | null`, `revokeSession(sessionId: string): void`, `revokeAllUserSessions(userId: string): number`, `cleanupExpiredSessions(): number`\n- **Dependencies**: `crypto` (Node built-in), session model\n- **Reuses**: None (new service)\n\n### Component 4: Brute Force Service (`packages/backend/src/services/brute-force.ts`)\n- **Purpose**: Track failed login attempts and enforce lockout (5 failures per 15 minutes)\n- **Interfaces**: `recordLoginAttempt(username, ipAddress, success): void`, `isLockedOut(username, ipAddress): boolean`, `clearLoginAttempts(username): void`, `cleanupOldAttempts(): number`\n- **Dependencies**: login_attempts model\n- **Reuses**: None (new service)\n\n### Component 5: Auth Middleware (`packages/backend/src/middleware/auth.ts`)\n- **Purpose**: Express middleware for JWT verification, role checks, and server permission checks\n- **Interfaces**: `requireAuth` (verify JWT, attach user to request), `requireRole(...roles)` (check user role), `requireOwner` (owner only), `requireAdminOrOwner` (admin or owner), `requireServerPermission(permission)` (check per-server permission)\n- **Dependencies**: JWT service, server-permission model\n- **Reuses**: Existing error classes (extended with `UnauthorizedError`, `ForbiddenError`)\n\n### Component 6: TLS Service (`packages/backend/src/services/tls.ts`)\n- **Purpose**: Configure HTTPS -- Let's Encrypt (HTTP-01 challenge), custom certificates, self-signed, or disabled\n- **Interfaces**: `setupTLS(config: TLSConfig, dataDir: string): Promise<{cert, key} | null>`\n- **Dependencies**: `@root/acme` (Let's Encrypt), `node-forge` (self-signed), `fs` (custom certs)\n- **Reuses**: Config/settings for TLS mode persistence\n\n### Component 7: UPnP Service (`packages/backend/src/services/upnp.ts`)\n- **Purpose**: Automatic port forwarding via UPnP for hosts without manual router access\n- **Interfaces**: `setupPortForwarding(port: number): Promise<boolean>`, `removePortForwarding(port: number): Promise<void>`\n- **Dependencies**: `nat-upnp` npm package\n- **Reuses**: None (new service)\n\n### Component 8: Auth Routes (`packages/backend/src/routes/auth.ts`)\n- **Purpose**: HTTP endpoints for setup, register, login, refresh, logout, logout-all\n- **Endpoints**: `POST /api/auth/setup`, `POST /api/auth/register`, `POST /api/auth/login`, `POST /api/auth/refresh`, `POST /api/auth/logout`, `POST /api/auth/logout-all`\n- **Dependencies**: Auth service, JWT service, session service, brute force service, user model, invitation model\n- **Reuses**: Zod validation patterns, Express route patterns\n\n### Component 9: User Routes (`packages/backend/src/routes/users.ts`)\n- **Purpose**: User profile and admin user management endpoints\n- **Endpoints**: `GET /api/users/me`, `PATCH /api/users/me`, `GET /api/users` (admin), `GET /api/users/:id` (admin), `PATCH /api/users/:id/role` (owner), `DELETE /api/users/:id` (owner)\n- **Dependencies**: User model, auth middleware\n- **Reuses**: Route handler patterns from existing server routes\n\n### Component 10: Invitation Routes (`packages/backend/src/routes/invitations.ts`)\n- **Purpose**: CRUD for invite codes (owner/admin only)\n- **Endpoints**: `POST /api/invitations`, `GET /api/invitations`, `DELETE /api/invitations/:id`\n- **Dependencies**: Invitation model, auth middleware\n- **Reuses**: Route handler patterns\n\n### Component 11: Server Permission Routes (extension to existing server routes)\n- **Purpose**: Granular per-server permission management\n- **Endpoints**: `GET /api/servers/:serverId/permissions`, `PUT /api/servers/:serverId/permissions/:userId`, `DELETE /api/servers/:serverId/permissions/:userId`\n- **Dependencies**: Server-permission model, auth middleware\n- **Reuses**: Existing server route file structure\n\n### Component 12: Security Middleware (`packages/backend/src/middleware/rate-limit.ts`, `cors.ts`, `security.ts`)\n- **Purpose**: Rate limiting (100 req/min general, 5 req/15min auth), CORS (Tauri origin + custom domain), Helmet security headers\n- **Dependencies**: `express-rate-limit`, `cors`, `helmet` npm packages\n- **Reuses**: None (new middleware layer)\n\n### Component 13: Frontend Auth Context (`packages/frontend/src/contexts/AuthContext.tsx`)\n- **Purpose**: React context providing auth state, automatic token refresh (1 min before expiry), and logout\n- **Interfaces**: `useAuth()` hook returning `{ user, accessToken, isAuthenticated, logout }`\n- **Dependencies**: Auth API client\n- **Reuses**: Existing React context patterns\n\n### Component 14: Frontend Auth Pages (`Setup.tsx`, `Login.tsx`, `Register.tsx`)\n- **Purpose**: Setup wizard (first run), login page, registration page (with invite code from URL)\n- **Dependencies**: Auth API client, AuthContext, React Router\n- **Reuses**: Tailwind styling patterns from existing pages\n\n### Component 15: Admin Panel (`packages/frontend/src/pages/Admin.tsx`)\n- **Purpose**: User list with role management, invitation list with create/delete, server permission management\n- **Dependencies**: User API, invitation API, auth middleware (admin/owner only)\n- **Reuses**: Table patterns from existing server list UI\n\n### Component 16: Protected Route Component (`packages/frontend/src/components/ProtectedRoute.tsx`)\n- **Purpose**: Route guard that redirects unauthenticated users to login\n- **Dependencies**: AuthContext\n- **Reuses**: None (simple wrapper component)\n\n## Data Models\n\n### users table\n```sql\nCREATE TABLE users (\n  id              TEXT PRIMARY KEY,                    -- nanoid\n  username        TEXT NOT NULL UNIQUE COLLATE NOCASE, -- case-insensitive unique\n  display_name    TEXT NOT NULL,\n  avatar_url      TEXT,\n  password_hash   TEXT NOT NULL,                       -- argon2id hash\n  role            TEXT NOT NULL DEFAULT 'member',      -- owner | admin | member\n  is_active       INTEGER NOT NULL DEFAULT 1,          -- soft delete / ban\n  created_at      TEXT NOT NULL DEFAULT (datetime('now')),\n  updated_at      TEXT NOT NULL DEFAULT (datetime('now')),\n  last_login_at   TEXT\n);\n```\n\n### sessions table (refresh tokens)\n```sql\nCREATE TABLE sessions (\n  id                 TEXT PRIMARY KEY,                  -- nanoid\n  user_id            TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  refresh_token_hash TEXT NOT NULL UNIQUE,              -- SHA-256 hash\n  device_info        TEXT,\n  ip_address         TEXT,\n  expires_at         TEXT NOT NULL,\n  created_at         TEXT NOT NULL DEFAULT (datetime('now')),\n  last_used_at       TEXT NOT NULL DEFAULT (datetime('now'))\n);\n```\n\n### invitations table\n```sql\nCREATE TABLE invitations (\n  id          TEXT PRIMARY KEY,                        -- nanoid\n  code        TEXT NOT NULL UNIQUE,                    -- 8-char nanoid\n  created_by  TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  max_uses    INTEGER NOT NULL DEFAULT 1,              -- 0 = unlimited\n  uses        INTEGER NOT NULL DEFAULT 0,\n  role        TEXT NOT NULL DEFAULT 'member',\n  expires_at  TEXT,                                    -- NULL = never expires\n  created_at  TEXT NOT NULL DEFAULT (datetime('now'))\n);\n```\n\n### server_permissions table\n```sql\nCREATE TABLE server_permissions (\n  id          TEXT PRIMARY KEY,                        -- nanoid\n  server_id   TEXT NOT NULL REFERENCES servers(id) ON DELETE CASCADE,\n  user_id     TEXT NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  can_view    INTEGER NOT NULL DEFAULT 1,\n  can_start   INTEGER NOT NULL DEFAULT 0,\n  can_console INTEGER NOT NULL DEFAULT 0,\n  can_edit    INTEGER NOT NULL DEFAULT 0,\n  created_at  TEXT NOT NULL DEFAULT (datetime('now')),\n  UNIQUE(server_id, user_id)\n);\n```\n\n### login_attempts table\n```sql\nCREATE TABLE login_attempts (\n  id           INTEGER PRIMARY KEY AUTOINCREMENT,\n  username     TEXT NOT NULL,\n  ip_address   TEXT NOT NULL,\n  success      INTEGER NOT NULL,                       -- 0 = failed, 1 = success\n  attempted_at TEXT NOT NULL DEFAULT (datetime('now'))\n);\n```\n\n### Shared TypeScript Types (added to `shared/src/index.ts`)\n\n```typescript\nexport type UserRole = 'owner' | 'admin' | 'member';\n\nexport interface User {\n  id: string;\n  username: string;\n  displayName: string;\n  avatarUrl: string | null;\n  role: UserRole;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n  lastLoginAt: string | null;\n}\n\nexport interface Session {\n  id: string;\n  userId: string;\n  deviceInfo: string | null;\n  ipAddress: string | null;\n  expiresAt: string;\n  createdAt: string;\n  lastUsedAt: string;\n}\n\nexport interface Invitation {\n  id: string;\n  code: string;\n  createdBy: string;\n  maxUses: number;\n  uses: number;\n  role: UserRole;\n  expiresAt: string | null;\n  createdAt: string;\n}\n\nexport interface ServerPermission {\n  id: string;\n  serverId: string;\n  userId: string;\n  canView: boolean;\n  canStart: boolean;\n  canConsole: boolean;\n  canEdit: boolean;\n  createdAt: string;\n}\n\nexport interface JWTPayload {\n  sub: string;       // User ID\n  username: string;\n  role: UserRole;\n  iat: number;\n  exp: number;\n}\n\nexport interface SetupRequest {\n  username: string;\n  password: string;\n  displayName: string;\n}\n\nexport interface RegisterRequest {\n  inviteCode: string;\n  username: string;\n  password: string;\n  displayName: string;\n}\n\nexport interface LoginRequest {\n  username: string;\n  password: string;\n}\n\nexport interface AuthResponse {\n  user: User;\n  accessToken: string;\n  refreshToken: string;\n}\n\nexport interface RefreshResponse {\n  accessToken: string;\n  refreshToken?: string;\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Invalid credentials on login**\n   - **Handling**: Return generic 401 \"Invalid credentials\" (no distinction between \"user not found\" and \"wrong password\" to prevent user enumeration). Record failed login attempt.\n   - **User Impact**: \"Invalid username or password\" toast.\n\n2. **Brute force lockout triggered**\n   - **Handling**: Return 429 after 5 failed attempts within 15 minutes for the same username or IP. Include `Retry-After` header.\n   - **User Impact**: \"Too many login attempts. Please try again later.\"\n\n3. **Expired or invalid invite code**\n   - **Handling**: Return 400 with specific reason (expired, exhausted, or not found -- safe to differentiate since invite codes are shared intentionally).\n   - **User Impact**: \"This invite code is expired / has been used / is invalid.\"\n\n4. **Access token expired**\n   - **Handling**: Frontend interceptor catches 401, automatically calls `/api/auth/refresh`. If refresh succeeds, retry original request. If refresh fails, redirect to login.\n   - **User Impact**: Seamless (invisible token refresh). Only visible if refresh token also expired.\n\n5. **Insufficient permissions (role or server-level)**\n   - **Handling**: Return 403 Forbidden. Frontend hides/disables controls the user lacks permissions for.\n   - **User Impact**: Forbidden controls are not visible. Direct API calls return \"Insufficient permissions.\"\n\n6. **TLS certificate provisioning fails**\n   - **Handling**: Log error, fall back to HTTP with prominent warning in logs and admin UI. Do not block server startup.\n   - **User Impact**: Admin sees \"TLS setup failed -- running without encryption\" warning in admin panel.\n\n7. **Owner account already exists during setup**\n   - **Handling**: Return 409 Conflict. Frontend redirects to login page.\n   - **User Impact**: \"Setup has already been completed. Please log in.\"\n\n8. **JWT secret lost (database corruption)**\n   - **Handling**: All existing tokens automatically become invalid (signature mismatch). New secret generated on startup. Users must re-authenticate.\n   - **User Impact**: Logged out on next request, must log in again.\n\n## File Structure\n\n### New Files\n```\npackages/backend/migrations/006_multi_user.sql        # All auth tables\npackages/backend/src/services/auth.ts                  # Password hashing (argon2id)\npackages/backend/src/services/jwt.ts                   # JWT generation/verification\npackages/backend/src/services/session.ts               # Refresh token management\npackages/backend/src/services/brute-force.ts           # Login attempt tracking\npackages/backend/src/services/tls.ts                   # TLS/HTTPS setup\npackages/backend/src/services/upnp.ts                  # UPnP port forwarding\npackages/backend/src/middleware/auth.ts                 # Auth middleware\npackages/backend/src/middleware/rate-limit.ts           # Rate limiting\npackages/backend/src/middleware/cors-config.ts          # CORS configuration\npackages/backend/src/middleware/security.ts             # Helmet headers\npackages/backend/src/routes/auth.ts                    # Auth endpoints\npackages/backend/src/routes/users.ts                   # User management endpoints\npackages/backend/src/routes/invitations.ts             # Invitation endpoints\npackages/backend/src/routes/acme.ts                    # ACME challenge handler\npackages/backend/src/models/user.ts                    # User DB queries\npackages/backend/src/models/session.ts                 # Session DB queries\npackages/backend/src/models/invitation.ts              # Invitation DB queries\npackages/backend/src/models/server-permission.ts       # Permission DB queries\npackages/frontend/src/pages/Setup.tsx                  # First-run setup wizard\npackages/frontend/src/pages/Login.tsx                  # Login page\npackages/frontend/src/pages/Register.tsx               # Registration page\npackages/frontend/src/pages/Admin.tsx                  # Admin panel\npackages/frontend/src/contexts/AuthContext.tsx         # Auth context + token refresh\npackages/frontend/src/components/ProtectedRoute.tsx    # Route guard\npackages/frontend/src/api/auth.ts                      # Auth API client\npackages/frontend/src/api/users.ts                     # User API client\npackages/frontend/src/api/invitations.ts               # Invitation API client\n```\n\n### Modified Files\n```\nshared/src/index.ts                                    # Add User, Session, Invitation, ServerPermission, auth types\npackages/backend/src/index.ts                          # HTTPS server setup, bind to 0.0.0.0\npackages/backend/src/config.ts                         # Add host, TLS, UPnP settings\npackages/backend/src/app.ts                            # Insert auth, rate-limit, CORS, Helmet middleware\npackages/backend/src/routes/servers.ts                 # Add permission checks to all endpoints\npackages/backend/src/ws/handlers.ts (or equivalent)    # Add auth to WebSocket connections\npackages/backend/src/utils/errors.ts                   # Add UnauthorizedError, ForbiddenError\npackages/frontend/src/App.tsx                          # Add AuthProvider, setup/login routes, protected routes\npackages/frontend/src/api/client.ts                    # Inject Authorization header\npackages/frontend/src/api/ws.ts                        # Pass access token in WS connection\npackages/frontend/src/main.tsx                         # Wrap app in AuthProvider\n```\n\n## API Endpoints\n\n### Auth Endpoints\n\n| Method | Path | Auth | Purpose |\n|--------|------|------|---------|\n| POST | `/api/auth/setup` | None | Create owner account (first run only) |\n| POST | `/api/auth/register` | None | Register with invite code |\n| POST | `/api/auth/login` | None | Login with credentials |\n| POST | `/api/auth/refresh` | None | Refresh access token |\n| POST | `/api/auth/logout` | None | Revoke refresh token |\n| POST | `/api/auth/logout-all` | Bearer | Revoke all sessions for current user |\n\n### User Endpoints\n\n| Method | Path | Auth | Purpose |\n|--------|------|------|---------|\n| GET | `/api/users/me` | Bearer | Get current user profile |\n| PATCH | `/api/users/me` | Bearer | Update profile (display name, avatar, password) |\n| GET | `/api/users` | Admin+ | List all users |\n| GET | `/api/users/:id` | Admin+ | Get user details + sessions |\n| PATCH | `/api/users/:id/role` | Owner | Change user role |\n| DELETE | `/api/users/:id` | Owner | Deactivate user |\n\n### Invitation Endpoints\n\n| Method | Path | Auth | Purpose |\n|--------|------|------|---------|\n| POST | `/api/invitations` | Admin+ | Create invitation |\n| GET | `/api/invitations` | Admin+ | List invitations |\n| DELETE | `/api/invitations/:id` | Admin+ | Delete invitation |\n\n### Server Permission Endpoints\n\n| Method | Path | Auth | Purpose |\n|--------|------|------|---------|\n| GET | `/api/servers/:serverId/permissions` | Admin+ | List permissions for server |\n| PUT | `/api/servers/:serverId/permissions/:userId` | Admin+ | Grant/update permissions |\n| DELETE | `/api/servers/:serverId/permissions/:userId` | Admin+ | Revoke permissions |\n\n## Dependencies\n\n### New Backend npm Packages\n- `argon2` -- Password hashing (argon2id)\n- `jsonwebtoken` + `@types/jsonwebtoken` -- JWT generation/verification\n- `express-rate-limit` -- Rate limiting middleware\n- `helmet` -- Security headers\n- `cors` + `@types/cors` -- CORS middleware\n- `@root/acme` -- Let's Encrypt ACME client\n- `node-forge` + `@types/node-forge` -- Self-signed certificate generation\n- `nat-upnp` -- UPnP port forwarding\n\n### New Frontend npm Packages\n- None -- uses existing React, React Router, Zustand, Tailwind\n\n## Testing Strategy\n\n### Unit Testing\n- No automated test framework exists. Manual verification per the testing checklist.\n- Key areas: password hashing roundtrip, JWT generation/verification, refresh token lifecycle, brute force lockout threshold.\n\n### Integration Testing\n- **Setup flow**: First run shows wizard, creates owner, redirects to dashboard\n- **Login flow**: Valid credentials succeed, invalid fail, brute force triggers lockout after 5 attempts\n- **Token refresh**: Access token auto-refreshes before expiry, expired refresh token triggers logout\n- **Invitation lifecycle**: Create invite, register with code, code exhausts at max uses, expired codes rejected\n- **Role permissions**: Owner full access, Admin manages users/servers, Member limited to granted servers\n- **Server permissions**: Granular flags work (view-only, start-only), Owner/Admin bypass checks\n- **WebSocket auth**: Connection requires valid token, expired token disconnects\n\n### End-to-End Testing\n- Full flow: Setup owner --> Create invite --> Friend registers --> Friend sees permitted servers --> Owner revokes access --> Friend loses access\n- TLS: Let's Encrypt provisions cert (requires domain), custom cert loads, self-signed works for LAN\n- Network: Backend on 0.0.0.0, accessible from other LAN devices\n",
  "fileStats": {
    "size": 24997,
    "lines": 514,
    "lastModified": "2026-02-12T00:07:53.356Z"
  },
  "comments": []
}