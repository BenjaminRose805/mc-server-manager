# Implementation Log: Task 5

**Summary:** Migrated all throw new Error(...) in 6 core service files to appropriate AppError subclasses (AppError 502 for upstream errors, ConflictError for state conflicts, ValidationError for invalid input/state). Left cancellation throws in download.ts and database guard in database.ts as raw Error per requirements.

**Timestamp:** 2026-02-15T22:25:18.269Z
**Log ID:** eb3f359d-a653-49f4-b2d1-84622a5a44bb

---

## Statistics

- **Lines Added:** +26
- **Lines Removed:** -14
- **Files Changed:** 6
- **Net Change:** 12

## Files Modified
- packages/backend/src/services/versions.ts
- packages/backend/src/services/process.ts
- packages/backend/src/services/java.ts
- packages/backend/src/services/mod-sources/modrinth.ts
- packages/backend/src/services/mod-sources/curseforge.ts
- packages/backend/src/services/modpack-parser.ts

## Files Created
_No files created_

---

## Artifacts

### Functions

#### getVersionManifest
- **Purpose:** Fetch Mojang version manifest - now throws AppError(502, UPSTREAM_ERROR) on HTTP failure
- **Location:** packages/backend/src/services/versions.ts:22
- **Signature:** () => Promise<MojangVersionManifest>
- **Exported:** Yes

#### getServerJarInfo
- **Purpose:** Fetch server JAR download URL - now throws AppError(502, UPSTREAM_ERROR) on HTTP failure
- **Location:** packages/backend/src/services/versions.ts:93
- **Signature:** (versionId: string) => Promise<{url, sha1, size} | null>
- **Exported:** Yes

#### getAdoptiumPlatform
- **Purpose:** Get Adoptium platform identifiers - now throws ValidationError on unsupported OS/architecture
- **Location:** packages/backend/src/services/java.ts:412
- **Signature:** () => {os: string, arch: string}
- **Exported:** No

#### downloadJava
- **Purpose:** Download Java from Adoptium - now throws AppError(502, UPSTREAM_ERROR) on HTTP/extraction failures
- **Location:** packages/backend/src/services/java.ts:431
- **Signature:** (version: number, dataDir: string) => Promise<JavaInstallation>
- **Exported:** Yes

#### modrinthFetch
- **Purpose:** Modrinth API fetch wrapper - now throws AppError(502, UPSTREAM_ERROR) on API errors
- **Location:** packages/backend/src/services/mod-sources/modrinth.ts:132
- **Signature:** <T>(path: string) => Promise<T>
- **Exported:** No

#### curseforgeFetch
- **Purpose:** CurseForge API fetch wrapper - now throws ValidationError when API key missing, AppError(502, UPSTREAM_ERROR) on API errors
- **Location:** packages/backend/src/services/mod-sources/curseforge.ts:145
- **Signature:** <T>(path: string) => Promise<T>
- **Exported:** No

#### curseforgePost
- **Purpose:** CurseForge API POST wrapper - now throws ValidationError when API key missing, AppError(502, UPSTREAM_ERROR) on API errors
- **Location:** packages/backend/src/services/mod-sources/curseforge.ts:171
- **Signature:** <T>(path: string, body: unknown) => Promise<T>
- **Exported:** No

#### parseMrpack
- **Purpose:** Parse .mrpack modpack files - now throws ValidationError when index not found
- **Location:** packages/backend/src/services/modpack-parser.ts:101
- **Signature:** (zipPath: string) => Promise<ParsedModpack>
- **Exported:** Yes

#### parseCurseForgeManifest
- **Purpose:** Parse CurseForge modpack ZIP - now throws ValidationError when manifest not found
- **Location:** packages/backend/src/services/modpack-parser.ts:178
- **Signature:** (zipPath: string) => Promise<ParsedModpack>
- **Exported:** Yes

### Classes

#### ServerProcess
- **Purpose:** Minecraft server Java child process manager - start/stop/kill/sendCommand now throw ConflictError instead of raw Error for state violations
- **Location:** packages/backend/src/services/process.ts:89
- **Methods:** start, stop, kill, sendCommand
- **Exported:** Yes

