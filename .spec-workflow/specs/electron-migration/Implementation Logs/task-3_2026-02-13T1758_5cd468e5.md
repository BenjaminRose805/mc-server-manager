# Implementation Log: Task 3

**Summary:** Extended backend Java service with multi-detection and Adoptium JDK download, ported from the Rust java.rs implementation. Added detectAllJavaInstallations() that scans JAVA_HOME, PATH, platform-specific directories, and launcher runtime dir with deduplication by realpath. Added downloadJava() that downloads from Adoptium API, extracts tar.gz/zip, and probes the result. Added GET /api/launcher/java and POST /api/launcher/java/download routes.

**Timestamp:** 2026-02-13T17:58:23.168Z
**Log ID:** 5cd468e5-1acd-4dac-892e-ef30c7475a11

---

## Statistics

- **Lines Added:** +230
- **Lines Removed:** -0
- **Files Changed:** 2
- **Net Change:** 230

## Files Modified
- packages/backend/src/services/java.ts
- packages/backend/src/routes/launcher.ts

## Files Created
_No files created_

---

## Artifacts

### API Endpoints

#### GET /api/launcher/java
- **Purpose:** Returns all detected Java installations on the system plus previously downloaded JDKs
- **Location:** packages/backend/src/routes/launcher.ts:198
- **Request Format:** No params
- **Response Format:** JavaInstallation[] — array of { version: number, path: string, vendor: string, fullVersion: string }

#### POST /api/launcher/java/download
- **Purpose:** Downloads a JDK from Adoptium and extracts it to the launcher runtime directory
- **Location:** packages/backend/src/routes/launcher.ts:206
- **Request Format:** { version: number } — major Java version (8-99)
- **Response Format:** JavaInstallation — { version: number, path: string, vendor: string, fullVersion: string }

### Functions

#### detectAllJavaInstallations
- **Purpose:** Scans JAVA_HOME, PATH, platform-specific dirs, and launcher runtime for all Java installations. Deduplicates by fs.realpathSync(). Returns sorted array (highest version first).
- **Location:** packages/backend/src/services/java.ts:289
- **Signature:** (dataDir?: string) => Promise<JavaInstallation[]>
- **Exported:** Yes

#### downloadJava
- **Purpose:** Downloads JDK from Adoptium API, extracts to {dataDir}/launcher/runtime/java-{version}/, probes and returns the installation
- **Location:** packages/backend/src/services/java.ts:422
- **Signature:** (version: number, dataDir: string) => Promise<JavaInstallation>
- **Exported:** Yes

#### parseJavaVendor
- **Purpose:** Parses vendor name from java -version stderr output (Eclipse Adoptium, Oracle, Microsoft, GraalVM, Azul Zulu, Amazon Corretto, OpenJDK, Unknown)
- **Location:** packages/backend/src/services/java.ts:182
- **Signature:** (stderr: string) => string
- **Exported:** No

#### probeJavaInstallation
- **Purpose:** Probes a Java binary path and returns a full JavaInstallation with version, vendor, and major version
- **Location:** packages/backend/src/services/java.ts:206
- **Signature:** (javaPath: string) => Promise<JavaInstallation | null>
- **Exported:** No

#### getJavaSearchDirs
- **Purpose:** Returns platform-specific directories to scan for JDK installations
- **Location:** packages/backend/src/services/java.ts:224
- **Signature:** () => string[]
- **Exported:** No

#### discoverJavaBinsInDir
- **Purpose:** Discovers java binaries in a directory by scanning subdirectories for bin/java or Contents/Home/bin/java (macOS)
- **Location:** packages/backend/src/services/java.ts:252
- **Signature:** (dir: string) => string[]
- **Exported:** No

#### findJavaBinaryInDir
- **Purpose:** Finds a java binary within an extracted JDK directory (handles nested dirs from Adoptium tarballs)
- **Location:** packages/backend/src/services/java.ts:367
- **Signature:** (dir: string) => string | null
- **Exported:** No

#### getAdoptiumPlatform
- **Purpose:** Maps Node.js os.platform()/os.arch() to Adoptium API parameter values
- **Location:** packages/backend/src/services/java.ts:401
- **Signature:** () => { os: string; arch: string }
- **Exported:** No

