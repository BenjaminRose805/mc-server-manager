# Tasks Document -- Server-Client Mod Synchronization

- [ ] 1. Add shared mod sync types to shared package
  - Files: `shared/src/index.ts` (modify)
  - Add types: `ServerModManifest`, `ManifestMod`, `ModSyncDiff`, `ModSyncProgress`, `ModSyncResult`
  - Purpose: Foundation types for the entire mod sync system
  - _Leverage: `shared/src/index.ts` for existing type patterns, `.spec-workflow/specs/mod-sync/design.md` Data Models section, `plans/EPIC-9-mod-sync.md` Shared Types section_
  - _Requirements: REQ-1, REQ-3, REQ-5, REQ-9_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: TypeScript Developer with expertise in shared type definitions for monorepo packages | Task: Read `shared/src/index.ts` to understand existing type patterns and exports (especially InstalledMod from Epic 4 and ModLoader if it exists from Epic 2). Add all mod sync types from `.spec-workflow/specs/mod-sync/design.md` Data Models section: (1) `ServerModManifest` interface with fields: serverId, serverName, mcVersion, loader (ModLoader type), loaderVersion, requiredMods (ManifestMod array), optionalMods (ManifestMod array), incompatibleMods (string array of Modrinth project IDs), generatedAt (ISO timestamp string). (2) `ManifestMod` interface with fields: modrinthId (string or null for non-Modrinth mods), modrinthVersionId (string or null), fileName, fileHash (SHA-1 string), fileSize (number), downloadUrl (string), name, version, side ('server' or 'client' or 'both'). (3) `ModSyncDiff` interface with fields: toInstall (ManifestMod array), toUpdate (array of objects with current: InstalledMod and target: ManifestMod), toRemove (InstalledMod array), toDisable (InstalledMod array), toKeep (InstalledMod array), optionalAvailable (ManifestMod array). (4) `ModSyncProgress` interface with fields: phase ('downloading' or 'verifying' or 'installing' or 'complete' or 'error'), currentMod (string or null), completed (number), total (number), error (string or null). (5) `ModSyncResult` interface with fields: success (boolean), installed (number), updated (number), removed (number), disabled (number), errors (string array). Export all types. Reference `plans/EPIC-9-mod-sync.md` Shared Types section for exact field definitions. | Restrictions: Do NOT remove or rename any existing types. Do NOT modify existing type definitions. Follow existing naming conventions (PascalCase interfaces). If ModLoader type does not exist yet, add it as a type alias for 'fabric' or 'forge' or 'neoforge' or 'quilt'. | Success: All five types compile, all exported, existing types unchanged, `npm run build -w shared` succeeds._

- [ ] 2. Create ModManifestService for manifest generation
  - Files: `packages/backend/src/services/mod-manifest-service.ts` (new)
  - Functions: generateManifest, getDownloadUrl, detectLoader
  - Purpose: Generate ServerModManifest from a server's installed mods
  - _Leverage: `packages/backend/src/models/mod.ts` (Epic 2 ModModel), `packages/backend/src/models/server.ts` (ServerModel), `plans/EPIC-9-mod-sync.md` Phase 9A.1_
  - _Requirements: REQ-1_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Backend Node.js Developer with expertise in service layer patterns | Task: Read `packages/backend/src/models/mod.ts` to understand how server mods are queried (especially getByServerId, and what fields InstalledMod has: modrinthId, modrinthVersionId, fileName, fileHash, fileSize, name, version, side, enabled). Read `packages/backend/src/models/server.ts` for getById. Create `packages/backend/src/services/mod-manifest-service.ts` with a class `ModManifestService`: (1) Constructor takes modModel and serverModel as dependencies. (2) `async generateManifest(serverId: string): Promise<ServerModManifest>` -- get server by ID (throw NotFoundError if not found), get installed mods by serverId, detect loader type from server. For each enabled mod, create a ManifestMod object: set downloadUrl using getDownloadUrl helper, include modrinthVersionId from the mod data, categorize by side (server/both goes to requiredMods, client goes to optionalMods). Skip disabled mods. Return the full ServerModManifest with generatedAt set to current ISO timestamp. (3) Private `getDownloadUrl(mod, serverId): string` -- if mod has modrinthId AND modrinthVersionId, return Modrinth CDN URL: `https://cdn.modrinth.com/data/MODRINTH_ID/versions/VERSION_ID/FILENAME`. Otherwise return the community server file endpoint: `/api/community/servers/SERVER_ID/mods/FILE_HASH/download`. (4) Private `detectLoader(server)` -- detect mod loader type and version from server data (check server.type or jar file naming conventions; if unsure, return a sensible default). Export singleton instance. Reference `plans/EPIC-9-mod-sync.md` Phase 9A.1. | Restrictions: Use existing error classes (NotFoundError). Follow existing service patterns (singleton export). Use `.js` extension in imports. Do NOT add new database queries -- use existing model methods. | Success: Service compiles, generates correct manifest from mock data, Modrinth CDN URLs formatted correctly, non-Modrinth mods use server file endpoint URL._

- [ ] 3. Add manifest and mod download endpoints to community routes
   - Files: `packages/backend/src/routes/community-servers.ts` (modify)
   - Add endpoints: GET /api/community/servers/:id/mod-manifest, GET /api/community/servers/:serverId/mods/:hash/download
   - Purpose: REST API for manifest fetching and mod file serving
   - _Leverage: `packages/backend/src/routes/community-servers.ts` (existing community routes from Epic 7), `plans/EPIC-9-mod-sync.md` Phase 9A.2_
   - _Requirements: REQ-2_
   - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Backend Node.js Developer with expertise in Express routing and file serving | Task: Read `packages/backend/src/routes/community-servers.ts` to understand existing route patterns, how access control is done (requireServerPermission middleware), and middleware usage. Add two new endpoints: (1) `GET /servers/:id/mod-manifest` -- verify user has access via requireServerPermission middleware (throw ForbiddenError if not). Call modManifestService.generateManifest(id). Return JSON response. (2) `GET /servers/:serverId/mods/:hash/download` -- verify user has access. Look up the mod by serverId and hash using modModel (find a method that can look up by hash, or query by serverId and filter). Get the file path by joining the server directory with 'mods' and the mod's fileName. CRITICAL SECURITY: Before constructing the file path, sanitize with `const safeName = path.basename(mod.fileName)`. Then construct the path as `const filePath = path.resolve(path.join(serverDir, 'mods', safeName))`. Verify `filePath.startsWith(path.resolve(path.join(serverDir, 'mods')))`. Return 400 if the original fileName contained any path separators ('/' or '\\'). Use res.download() to serve the file. Import the ModManifestService and instantiate/use it. Add appropriate error handling with try/catch/next pattern. Reference `plans/EPIC-9-mod-sync.md` Phase 9A.2. | Restrictions: Do NOT break existing community routes. Follow existing route handler patterns exactly (try/catch/next). Path traversal protection is mandatory -- resolve paths and compare. Use `.js` extension in imports. Access control MUST be checked on both endpoints. | Success: Both endpoints compile, manifest returns correct JSON, file download serves mod files, path traversal is blocked, access control enforced._

- [ ] 4. Create ModSyncService for client-side diff computation
  - Files: `packages/frontend/src/services/mod-sync-service.ts` (new)
  - Functions: computeDiff, estimateDownloadSize, formatSize
  - Purpose: Compare server manifest with local mods and produce a categorized diff
  - _Leverage: `.spec-workflow/specs/mod-sync/design.md` Diff Computation Flow, `plans/EPIC-9-mod-sync.md` Phase 9B.1_
  - _Requirements: REQ-3, REQ-6_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Frontend TypeScript Developer with expertise in data comparison algorithms | Task: Create `packages/frontend/src/services/mod-sync-service.ts`. Export a class `ModSyncService` and a singleton `modSyncService`. Implement: (1) `computeDiff(manifest: ServerModManifest, localMods: InstalledMod[]): ModSyncDiff` -- Build four lookup Maps: localByHash (fileHash to InstalledMod), localByModrinthId (modrinthId to InstalledMod, filtering nulls), manifestByHash (fileHash to ManifestMod from requiredMods), manifestByModrinthId (modrinthId to ManifestMod, filtering nulls). First pass -- iterate manifest.requiredMods: if localByHash has a match, skip (exact match, already installed). Else if modrinthId is non-null and localByModrinthId has a match, add to toUpdate with current and target. Else add to toInstall. Second pass -- iterate localMods: skip any that are in manifestByHash or manifestByModrinthId (already handled). If modrinthId is in manifest.incompatibleMods, add to toDisable. If side is 'client', add to toKeep. If side is 'server' or 'both', add to toRemove. If side is unknown/undefined, add to toKeep (safe default). Set optionalAvailable to manifest.optionalMods. Return the full ModSyncDiff. (2) `estimateDownloadSize(diff: ModSyncDiff): number` -- sum fileSize of all toInstall mods plus all toUpdate target mods. (3) `formatSize(bytes: number): string` -- format as B, KB (1 decimal), or MB (1 decimal) depending on magnitude. Import all types from '@mc-server-manager/shared'. Reference `plans/EPIC-9-mod-sync.md` Phase 9B.1. | Restrictions: This is a pure logic service with no side effects or API calls. All comparison is in-memory. Must handle null modrinthId values gracefully (skip null keys in maps). Do NOT modify local mods or trigger any downloads. | Success: Diff correctly categorizes all 5 types (install, update, remove, disable, keep), handles null modrinthIds, size estimation sums correctly, format shows correct units._

- [ ] 5. Create ModDownloadService for downloading and installing mods
  - Files: `packages/frontend/src/services/mod-download-service.ts` (new)
  - Functions: downloadAndInstall, downloadFile, isTrustedUrl, computeSHA1, installMod
  - Purpose: Download mods from trusted sources, verify hashes, install to client instance
  - _Leverage: `plans/EPIC-9-mod-sync.md` Phase 9D.1, existing Electron IPC patterns_
  - _Requirements: REQ-5_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Frontend TypeScript Developer with expertise in file downloads and cryptographic verification | Task: Create `packages/frontend/src/services/mod-download-service.ts`. Export class `ModDownloadService` and singleton `modDownloadService`. Implement: (1) `async downloadAndInstall(instanceId: string, mods: ManifestMod[], onProgress: (progress: ModSyncProgress) => void): Promise<ModSyncResult> (with fields: success, installed count, updated count, removed count, disabled count, and errors array)` -- process mods with a concurrency limit of 5. Use a queue pattern: start up to 5 concurrent workers, each picks next mod from queue. For each mod: report progress as 'downloading', download the file, report 'verifying', compute SHA-1, compare to mod.fileHash (throw on mismatch with descriptive message), report 'installing', call installMod. Track completed count. On any error for a mod, record the error string and continue. After all done, report final progress as 'complete' or 'error'. Return success and errors. (2) Private `async downloadFile(url: string): Promise<Uint8Array>` -- validate URL with isTrustedUrl first (throw if untrusted). Use Electron IPC via `window.electronAPI` for HTTP download if available, or fall back to fetch API. Return bytes. (3) Private `isTrustedUrl(url: string): boolean` -- parse URL. Allow hosts: cdn.modrinth.com, github.com, raw.githubusercontent.com. Also allow relative URLs starting with /api/community/. Return false for everything else. (4) Private `computeSHA1(data: Uint8Array): string` -- use Web Crypto API (crypto.subtle.digest('SHA-1', data)) and convert to hex string. (5) Private `async installMod(instanceId: string, mod: ManifestMod, fileData: Uint8Array): Promise<void>` -- use Electron IPC or a backend API call to write the file to the instance mods directory and update the installed_mods DB record. Before downloading, if mod.modrinthId is non-null, verify that mod.downloadUrl starts with 'https://cdn.modrinth.com/'. If it doesn't match, mark the mod as unverified and skip the Modrinth API cross-verification (the modrinthId claim is suspect). Log a warning. For mods with a non-null modrinthId and modrinthVersionId, add a verification step: call `GET https://api.modrinth.com/v2/version/{modrinthVersionId}` and compare `files[].hashes.sha1` against the manifest's fileHash. If they don't match, reject the download with error 'Mod hash mismatch with Modrinth registry'. This prevents host-side hash tampering. For Modrinth API cross-verification, batch version lookups using Modrinth's `POST /v2/versions` endpoint when available, to reduce API calls. Implement a client-side rate limiter of 5 requests/second for Modrinth API calls. For mods WITHOUT a modrinthId (community server downloads), mark them as 'unverified' in the progress callback so the UI can show a warning. Reference `plans/EPIC-9-mod-sync.md` Phase 9D.1. | Restrictions: ALWAYS validate URL before downloading. ALWAYS verify hash before installing. Delete/discard downloaded data if hash does not match. Use Web Crypto API for SHA-1 (available in browser and Electron renderer). Concurrency must be limited to 5. Progress callback must be called for each phase transition. | Success: Downloads are parallel (max 5), hash verification works, untrusted URLs rejected, progress reported for each mod, errors collected without aborting._

- [ ] 6. Create ModSyncDialog UI component
  - Files: `packages/frontend/src/components/community/ModSyncDialog.tsx` (new)
  - Purpose: Confirmation dialog showing categorized mod changes before sync
  - _Leverage: `plans/EPIC-9-mod-sync.md` Phase 9C.1, existing Tailwind dialog patterns_
  - _Requirements: REQ-4, REQ-6, REQ-7_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: React Frontend Developer with expertise in modal dialogs and Tailwind CSS | Task: Create `packages/frontend/src/components/community/ModSyncDialog.tsx`. Export a named component `ModSyncDialog` with props: manifest (ServerModManifest), diff (ModSyncDiff), onConfirm (() => void), onCancel (() => void). Layout: fixed overlay (bg-black/50, z-50), centered card (bg-white dark:bg-gray-800, rounded-lg, max-w-2xl, max-h-80vh overflow-hidden). Header section: title "Sync Mods for SERVER_NAME", subtitle "The following changes are required to join this server:". Scrollable content area (max-h-96, overflow-y-auto) with sections: (A) "Install N mod(s)" with green Download icon -- list each mod as "name version". (B) "Update N mod(s)" with blue Download icon -- list each as "name currentVersion to targetVersion". (C) "Remove N mod(s)" with orange X icon and warning text. (D) "Disable N incompatible mod(s)" with red AlertTriangle icon and warning. (E) "Keep N client-only mod(s)" with gray Check icon, collapsible (starts collapsed). Each section only renders if its array is non-empty. Below sections, if download size is greater than 0, show a blue info box with total download size (use modSyncService.estimateDownloadSize and formatSize). Non-Modrinth mods (where modrinthId is null) should display with a small warning badge (AlertTriangle icon, amber) and tooltip 'Not independently verified â€” downloaded from server host'. This distinguishes trusted (Modrinth-verified) mods from unverified community uploads. If any mods in toInstall or toUpdate have modrinthId === null, render a checkbox at the bottom of the dialog: 'I trust the server owner for N unverified mod(s)' with an AlertTriangle icon. The 'Sync and Join' button must be disabled (gray, pointer-events-none) until this checkbox is checked. Use useState for the checkbox state. Footer: Cancel button (gray) and "Sync and Join" button (blue-600). Create a helper Section subcomponent with props: icon, title, items (string array), optional warning text, optional collapsible flag. Use useState for collapsed state. Import icons from lucide-react: Download, AlertTriangle, Check, X. Reference `plans/EPIC-9-mod-sync.md` Phase 9C.1. | Restrictions: Use Tailwind dark theme classes. Do NOT use any external modal/dialog library. If there are no changes at all, return null (parent should handle this case). Use lucide-react for all icons. | Success: Dialog renders all 5 sections correctly, empty sections are hidden, collapsible section works, download size displayed, confirm and cancel callbacks fire._

- [ ] 7. Create ModSyncProgressDialog UI component
  - Files: `packages/frontend/src/components/community/ModSyncProgressDialog.tsx` (new)
  - Purpose: Progress overlay during mod downloading, verifying, and installing
  - _Leverage: `plans/EPIC-9-mod-sync.md` Phase 9E.2, existing Tailwind patterns_
  - _Requirements: REQ-9_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: React Frontend Developer with expertise in progress indicators and Tailwind CSS | Task: Create `packages/frontend/src/components/community/ModSyncProgressDialog.tsx`. Export a named component `ModSyncProgressDialog` with props: progress (ModSyncProgress). Layout: fixed overlay (bg-black/50, z-50), centered card (bg-white dark:bg-gray-800, rounded-lg, p-6, max-w-md). Header: spinning Loader2 icon from lucide-react with text "Syncing Mods...". Content: (A) Phase label -- show "Downloading" or "Verifying" or "Installing" or "Complete" or "Error" based on progress.phase. (B) Progress bar: full-width bg-gray-200 dark:bg-gray-700 rounded-full h-2, with inner div bg-blue-600 h-2 rounded-full with width set to percentage (completed/total times 100). Percentage text shown to the right. (C) Current mod info: if currentMod is non-null, show "modName (completedPlusOne/total)". (D) Error display: if error is non-null, show red text with the error message. Use transition-all on the progress bar width for smooth animation. Reference `plans/EPIC-9-mod-sync.md` Phase 9E.2. | Restrictions: Use Tailwind classes only for styling. No external progress bar library. Handle edge case where total is 0 (show 0%). Do NOT add a cancel button (sync cannot be cancelled mid-download in this version). | Success: Progress bar animates, phase label updates, current mod shown, errors displayed in red, percentage calculated correctly._

- [ ] 8. Integrate mod sync into ServerCard join flow
   - Files: `packages/frontend/src/components/ServerCard.tsx` (modify)
  - Wire: fetch manifest, compute diff, show dialog, download mods, disable incompatible, launch
  - Purpose: Connect all sync components into the existing Join button flow
  - _Leverage: `plans/EPIC-9-mod-sync.md` Phase 9E.1, existing ServerCard from Epic 7_
  - _Requirements: REQ-8_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: React Frontend Developer with expertise in complex async UI flows | Task: Read `packages/frontend/src/components/ServerCard.tsx` to understand the existing component structure and Join button. Modify the component to add mod sync: (1) Add state: showSyncDialog (boolean), manifest (ServerModManifest or null), diff (ModSyncDiff or null), syncing (boolean), progress (ModSyncProgress or null). (2) On Join click (handleJoinClick): find a compatible client instance matching the server's mcVersion (from instance store, Epic 4). If none found, show toast error and return. Fetch manifest via GET /api/community/servers/ID/mod-manifest. Fetch local mods for the target instance. Call modSyncService.computeDiff(manifest, localMods). Check if diff has any changes (toInstall, toUpdate, toRemove, or toDisable non-empty). If changes: set state and show ModSyncDialog. If no changes: call launchAndConnect directly. (3) On sync confirm (handleSyncConfirm): hide dialog, set syncing=true. Build download list from diff.toInstall plus diff.toUpdate targets. Call modDownloadService.downloadAndInstall(instanceId, downloadList, setProgress). If errors, show toast and return. Disable incompatible mods by calling PATCH API for each mod in diff.toDisable (set enabled=false). Call launchAndConnect(instanceId, server). Finally set syncing=false. (4) launchAndConnect: invoke Minecraft launch with instanceId and server address. (5) Render: show ModSyncDialog when showSyncDialog is true. Show ModSyncProgressDialog when syncing is true and progress is non-null. Disable Join button while syncing, show "Syncing..." text. Import ModSyncDialog, ModSyncProgressDialog, modSyncService, modDownloadService. Reference `plans/EPIC-9-mod-sync.md` Phase 9E.1. | Restrictions: Do NOT break existing ServerCard rendering or other functionality. Handle all async errors with try/catch and toast notifications. The Join button must be disabled during sync. Do NOT auto-confirm -- always require user confirmation if there are changes. | Success: Join flow works end-to-end: manifest fetched, diff computed, dialog shown, mods downloaded on confirm, incompatible mods disabled, game launches._

- [ ] 9. Add client-only mod preservation logic to diff computation
  - Files: `packages/frontend/src/services/mod-sync-service.ts` (modify, if not fully covered in task 4)
  - Ensure client-only mods are correctly preserved and categorized
  - Purpose: Verify and harden the preservation of player's client-only mods
  - _Leverage: `.spec-workflow/specs/mod-sync/design.md` Diff Computation Flow_
  - _Requirements: REQ-6_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Frontend TypeScript Developer with expertise in data categorization logic | Task: Read `packages/frontend/src/services/mod-sync-service.ts` (created in task 4). Verify and enhance the client-only mod preservation logic: (1) Confirm that local mods with side='client' that are NOT in the manifest's requiredMods or incompatibleMods are added to toKeep. (2) Confirm that local mods with an unknown, undefined, or empty side value default to toKeep (safe default -- never remove a mod when the side is uncertain). (3) Confirm that mods already matched by hash (exact match with manifest) are NOT added to toKeep -- they are simply ignored as already-correct. (4) Add a guard: if a local client-only mod has the same modrinthId as a manifest requiredMod but different hash, it should go to toUpdate (the server may require a specific version of a mod that happens to be client-side too). (5) Verify optionalAvailable is populated from manifest.optionalMods. If the computeDiff logic in task 4 already handles all of these correctly, verify and add inline comments documenting the preservation behavior. If any edge case is missing, add the logic. | Restrictions: Do NOT change the function signatures. Do NOT remove existing categorization logic. The safe default MUST be toKeep (never silently remove a mod). | Success: Client-only mods with no manifest match go to toKeep, unknown-side mods go to toKeep, already-matching mods are skipped, client mods that need version updates go to toUpdate._

- [ ] 10. Add incompatible mod disabling logic
  - Files: `packages/frontend/src/services/mod-sync-service.ts` (modify, if needed), `packages/frontend/src/components/ServerCard.tsx` (verify)
  - Ensure incompatible mods are disabled (.jar to .jar.disabled) during sync
  - Purpose: Handle mods that the server explicitly marks as incompatible
  - _Leverage: `plans/EPIC-9-mod-sync.md` Conflict Resolution Strategies_
  - _Requirements: REQ-7_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Frontend TypeScript Developer | Task: Verify and complete the incompatible mod disabling flow across the sync pipeline: (1) In `mod-sync-service.ts`: confirm that computeDiff checks manifest.incompatibleMods (array of Modrinth project IDs) against each local mod's modrinthId. Any match goes to toDisable. Confirm mods without a modrinthId cannot be flagged as incompatible (since the incompatibleMods list uses Modrinth IDs). (2) In `ServerCard.tsx` (handleSyncConfirm): verify that after successful downloads, each mod in diff.toDisable is disabled via the appropriate API call. The API call should either: (a) PATCH the mod's enabled status to false (which should rename .jar to .jar.disabled on the backend), or (b) directly invoke an Electron IPC command to rename the file. Check which approach the existing Epic 4 client mod management uses and follow the same pattern. (3) Verify the ModSyncDialog shows toDisable mods with the red AlertTriangle icon and warning text "These mods are incompatible with the server and must be disabled." | Restrictions: Do NOT remove mods entirely -- only disable (rename to .jar.disabled). This must be reversible. Follow the existing mod enable/disable pattern from Epic 4. | Success: Incompatible mods detected in diff, shown in dialog with warning, disabled on confirm via correct API, reversible rename pattern used._

- [ ] 11. End-to-end manual testing and polish
  - Files: Multiple files (read-only verification, minor fixes as needed)
  - Purpose: Verify the complete sync flow works end-to-end and fix edge cases
  - _Leverage: `.spec-workflow/specs/mod-sync/design.md` Testing Strategy section, `plans/EPIC-9-mod-sync.md` Testing Checklist_
  - _Requirements: REQ-1, REQ-2, REQ-3, REQ-4, REQ-5, REQ-6, REQ-7, REQ-8, REQ-9_
  - _Prompt: Implement the task for spec mod-sync, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer and Frontend/Backend Developer | Task: Perform end-to-end verification of the complete mod sync flow. Walk through each scenario from the testing checklist in `.spec-workflow/specs/mod-sync/design.md` Testing Strategy section: (1) No changes needed -- verify direct launch without dialog. (2) Install required mod -- verify dialog, download, hash verification, installation. (3) Update mod version -- verify dialog shows version change, old file replaced. (4) Remove extra server mod -- verify warning shown, mod disabled on confirm. (5) Disable incompatible mod -- verify red warning, .jar renamed to .jar.disabled. (6) Keep client-only mod -- verify shown in collapsible section, not modified. (7) Hash mismatch -- verify error displayed, file not installed. (8) Untrusted URL -- verify security error. (9) Cancel sync -- verify no changes made. (10) Non-Modrinth mod -- verify download from community server endpoint. Fix any issues found during testing. Verify error messages are clear and actionable. Verify progress dialog updates smoothly. Verify toast notifications appear for errors. Check that the Join button is properly disabled during sync and re-enabled after completion or failure. | Restrictions: Do NOT add new features. Only fix bugs and edge cases found during testing. Do NOT change the sync protocol or data models. | Success: All 10 test scenarios pass. Error messages are clear. Progress tracking works smoothly. No uncaught exceptions. Join button state is correct throughout the flow._
